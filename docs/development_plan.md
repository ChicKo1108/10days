# 《10日计划-静待花开》开发实施计划表

本计划表基于 [PRD V3.0](./base_prd.md) 制定，旨在通过分阶段迭代，实现微信小程序 + Express + PostgreSQL 的全栈开发，重点还原“新中式水墨风”的视觉体验与“动态拆解”的核心业务逻辑。

---

## 📅 阶段一：基础设施与环境搭建 (Phase 1: Infrastructure & Setup)
**目标：** 完成前后端项目初始化，打通数据库连接，确立代码规范。

### 1.1 后端环境 (Backend)
- [ ] **项目初始化**：搭建 Node.js + Express 项目结构。
- [ ] **数据库准备**：安装并配置 PostgreSQL，创建 `10days_db` 数据库。
- [ ] **ORM 配置**：集成 Sequelize ORM，配置数据库连接池。
- [ ] **基础中间件**：配置 CORS、BodyParser、日志记录 (Morgan/Winston) 及错误处理中间件。

### 1.2 前端环境 (Frontend - Wechat Mini Program)
- [ ] **项目创建**：使用微信开发者工具创建小程序项目 (原生框架)。
- [ ] **目录规划**：建立微信小程序的标准目录。
- [ ] **资源准备**：引入FontAwesome图标库。

### 1.3 规范制定
- [ ] **API 规范**：确定 RESTful 接口响应格式 (Code, Data, Message)。
- [ ] **Git 规范**：创建git仓库，保证代码提交规范。
    - 每个功能模块对应一个分支，分支命名为 `feature/模块名`（如 `feature/plan_management`）。
    - 提交消息采用 `[模块名] 功能描述` 格式（如 `[plan_management] 新增长卷创建接口`）。

---

## 🎨 阶段二：视觉系统与静态页面 (Phase 2: UI/UX Foundation)
**目标：** 实现“水墨风”视觉基调，完成核心页面的静态布局。

### 2.1 全局视觉定义
- [ ] **色板配置**：在 `app.wxss` 中定义 CSS 变量：
    - 背景色：`--paper-bg: #F7F4ED` (宣纸色 + 纹理图)
    - 墨色：`--ink-black: #2C2C2C`
    - 朱砂红：`--cinnabar-red: #B22222`
- [ ] **字体样式**：配置全局字体类 `.font-song` (宋体标题) 和 `.font-sans` (黑体正文)。
- [ ] **公共组件**：
    - `InkButton`：无边框、书法笔触风格按钮。
    - `PaperCard`：带微阴影的宣纸卡片容器。

### 2.2 核心页面静态搭建
- [ ] **首页 (The Hub)**：长卷列表布局，展示标题、进度概览。
- [ ] **画布页 (Master Canvas)**：横向滚动视图，展示 Quest 方块链条。
- [ ] **执行页 (Quest Detail)**：核心页面，布局 10 个墨点位置（弧形/直线）。
- [ ] **复盘页 (Review)**：结项评价与心情记录表单。

---

## ⚙️ 阶段三：后端核心业务开发 (Phase 3: Backend Core Development)
**目标：** 实现数据库模型与核心 API，确保业务逻辑闭环。

### 3.1 数据库建模 (Schema Migration)
- [ ] **MasterPlans 表**：定义长卷 ID、用户、标题、总篇章数、主题色等字段。
- [ ] **Quests 表**：定义篇章 ID、关联 Plan、每日任务 JSON、打卡数组 (Array)、状态等字段。

### 3.2 核心 API 开发
- [ ] **长卷管理**：
    - `POST /api/plans`：创建新计划（立项）。
    - `GET /api/plans`：获取计划列表。
- [ ] **画布数据**：
    - `GET /api/plans/:id/canvas`：获取指定计划的所有篇章状态及进度。
- [ ] **篇章执行**：
    - `GET /api/quests/:id`：获取当前篇章详情及每日任务。
    - `PATCH /api/quests/:id/checkin`：处理打卡逻辑（更新 `check_in_data` 数组）。
    - `PATCH /api/quests/:id/buffer`：消耗精力值（跳过逻辑）。

### 3.3 AI 服务集成 (Mock/Real)
- [ ] **Prompt 工程**：设计用于生成后续 10 天任务的提示词模板。
- [ ] **生成接口**：
    - `POST /api/quests/:id/roll`：接收复盘数据，调用 LLM (或 Mock 数据) 生成下一阶段任务并存入数据库。

---

## 🖌️ 阶段四：前端交互与动效实现 (Phase 4: Interaction & Animation)
**目标：** 对接 API，实现“墨色洇染”等核心动效，提升用户体验。

### 4.1 数据联调
- [ ] **网络层封装**：封装 `wx.request`，统一处理 Token 及错误拦截。
- [ ] **页面逻辑绑定**：
    - 首页列表渲染与跳转。
    - 画布页数据的横向渲染与动态加载。
    - 执行页每日任务的展示与状态判断。

### 4.2 核心动效开发 (关键点)
- [ ] **墨色洇染动画**：
    - 技术方案：使用 `Canvas` 或 CSS3 `mask-image` + `scale` 动画。
    - 效果：长按墨点时，朱砂色从中心向外不规则扩散，填满圆形。
- [ ] **卷轴拉伸效果**：
    - 场景：画布页左右滑动时。
    - 效果：边缘增加阴影渐变，模拟纸张卷曲感。
- [ ] **印章落款动画**：
    - 场景：复盘提交成功后。
    - 效果：方篆印章配合 `scale` 缩小 + 尘土飞扬粒子效果 (可选) 盖在屏幕中央。

---

## 🚀 阶段五：测试与优化 (Phase 5: Testing & Optimization)
**目标：** 修复 Bug，优化性能，确保产品稳定上线。

### 5.1 功能测试
- [ ] **逻辑测试**：验证打卡状态更新、精力值扣减、篇章解锁逻辑是否准确。
- [ ] **AI 流程测试**：验证“复盘 -> AI 生成 -> 新篇章入库”的完整链路。

### 5.2 UI/UX 优化
- [ ] **真机适配**：检查不同尺寸屏幕下的布局（特别是刘海屏适配）。
- [ ] **加载体验**：增加骨架屏 (Skeleton) 或水墨加载动画。

### 5.3 部署准备
- [ ] **后端部署**：配置服务器环境 (PM2, Nginx, SSL)。
- [ ] **小程序发布**：代码上传、版本提交与审核。

---

## 📝 附录：开发资源索引
- **PRD 文档**: `docs/base_prd.md`
- **设计素材**: (待补充设计稿路径)
- **API 文档**: (待生成 Swagger/Markdown)
