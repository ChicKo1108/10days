<view class="container">
  <view class="header anim-fade-in">
    <text class="title font-song">{{isEdit ? 'ф┐ошовчпЗчла' : 'шзДхИТчпЗчла'}}</text>
    <text class="subtitle font-sans text-gray">ф╣жчлех╖▓ф╕║цВи{{isEdit ? 'щЗНч╗Ш' : 'цЛЖшзг'}}цЦ╣цбИя╝Мшп╖чбошодцИЦф┐оцФ╣</text>
    
    <!-- щХ┐хН╖цибх╝ПцПРчд║ -->
    <view class="plan-tag font-sans" wx:if="{{type === 'plan' && planTitle}}">
      <text>цЙАх▒ЮщХ┐хН╖я╝Ъ{{planTitle}}</text>
    </view>
    
    <view class="ink-line"></view>
  </view>

  <scroll-view scroll-y class="plan-scroll anim-fade-in" style="animation-delay: 0.2s;">
    <!-- хдЪчпЗчлащвДшзИ (щХ┐хН╖цибх╝П) -->
    <block wx:if="{{type === 'plan'}}">
      <view class="stage-section" wx:for="{{chapters}}" wx:key="index">
        <view class="stage-header">
          <text class="stage-title font-song">чмм {{index + 1}} чпЗчла ({{item.isLocked ? 'х╛ЕшзгщФБ' : 'хН│х░Жх╝АхРп'}})</text>
        </view>
        
        <block wx:if="{{!item.isLocked}}">
          <!-- чпЗчлахЯ║чбАф╗╗хКб -->
          <paper-card>
             <view class="task-label font-song text-gray">цпПцЧеф┐оф╣а</view>
             <view class="task-input-wrapper">
              <textarea 
                class="task-input font-sans" 
                auto-height 
                value="{{item.baseTask}}" 
                bindinput="handleChapterBaseInput" 
                data-index="{{index}}"
              ></textarea>
            </view>
          </paper-card>

          <!-- чпЗчлащШ╢цо╡ф╗╗хКб -->
          <view class="sub-stages">
             <view class="sub-stage-item" wx:for="{{item.stages}}" wx:key="sIndex" wx:for-item="stage" wx:for-index="sIndex">
                <text class="sub-stage-label font-sans text-gray">{{stage.name}} ({{stage.days}})</text>
                <input class="sub-stage-input font-sans" value="{{stage.task}}" bindinput="handleChapterStageInput" data-cindex="{{index}}" data-sindex="{{sIndex}}" />
             </view>
          </view>
        </block>

        <block wx:else>
           <paper-card className="locked-card">
             <view class="locked-content text-center">
               <text class="locked-icon">ЁЯФТ</text>
               <text class="locked-text font-song text-gray">хоМцИРхЙНх║ПчпЗчлахРОшзгщФБ</text>
             </view>
           </paper-card>
        </block>
      </view>
    </block>

    <!-- хНХчпЗчлацибх╝П (хОЯцЬЙщА╗ш╛С) -->
    <block wx:else>
      <!-- хЯ║чбАцЬЯ (Day 1-10 цпПцЧещЗНхдН) -->
      <view class="stage-section">
        <view class="stage-header">
          <text class="stage-title font-song">хЯ║чЯ│ ┬╖ цпПцЧеф┐оф╣а</text>
          <text class="stage-desc font-sans text-gray">ш┤пчй┐хНБцЧечЪДцпПцЧех┐Еф┐ошп╛</text>
        </view>
        <paper-card>
          <view class="task-input-wrapper">
            <textarea 
              class="task-input font-sans" 
              auto-height 
              value="{{baseTask}}" 
              bindinput="handleInput" 
              data-field="baseTask"
              placeholder="ф╛ЛхжВя╝ЪцпПцЧеч╗Гф╣ачИмца╝хнР 15 хИЖщТЯ"
            ></textarea>
          </view>
        </paper-card>
      </view>

      <!-- ш┐ЫщШ╢ф╕ЙщШ╢цо╡ -->
      <view class="stage-section" wx:for="{{stages}}" wx:key="index">
        <view class="stage-header">
          <text class="stage-title font-song">{{item.name}} ({{item.days}})</text>
        </view>
        <paper-card>
          <view class="task-input-wrapper">
            <textarea 
              class="task-input font-sans" 
              auto-height 
              value="{{item.task}}" 
              bindinput="handleStageInput" 
              data-index="{{index}}"
              placeholder="шп╖ш╛УхЕещШ╢цо╡чЫоцаЗ..."
            ></textarea>
          </view>
        </paper-card>
      </view>
    </block>

    <view class="footer-spacer"></view>
  </scroll-view>

  <view class="footer anim-fade-in" style="animation-delay: 0.4s;">
    <ink-btn type="primary" bindtap="confirmPlan">{{isEdit ? 'чбошодф┐ошов' : 'чбошодх╝АхРп'}}</ink-btn>
  </view>
</view>
